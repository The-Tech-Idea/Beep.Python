<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Analysis Pipeline Example - Beep.Python.DataManagement</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet">
    <link href="../assets/styles.css" rel="stylesheet">
</head>
<body>
    <!-- Mobile Menu Toggle -->
    <button class="mobile-menu-toggle" onclick="toggleSidebar()">
        <i class="bi bi-list"></i>
    </button>

    <!-- Theme Toggle -->
    <button class="theme-toggle" onclick="toggleTheme()" title="Toggle theme">
        <i class="bi bi-sun-fill" id="theme-icon"></i>
    </button>

    <div class="container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <!-- Navigation will be loaded dynamically by navigation.js -->
        </aside>

        <!-- Main Content -->
        <main class="content">
            <div class="content-wrapper">
                <!-- Breadcrumb Navigation -->
                <div class="breadcrumb-nav">
                    <a href="../index.html">Home</a>
                    <span>?</span>
                    <a href="../index.html#examples">Examples</a>
                    <span>?</span>
                    <span>Data Analysis Pipeline</span>
                </div>

                <!-- Page Header -->
                <div class="page-header">
                    <h1><i class="bi bi-diagram-3"></i> Complete Data Analysis Pipeline</h1>
                    <p class="page-subtitle">End-to-end example demonstrating sales data analysis, from raw data loading to insights generation and reporting</p>
                </div>

                <!-- Overview -->
                <section class="section" id="overview">
                    <h2>?? Scenario Overview</h2>
                    <p>
                        This example demonstrates a complete data analysis pipeline for a retail company analyzing their sales performance. 
                        We'll load data from multiple sources, clean and transform it, perform statistical analysis, and generate business insights.
                    </p>
                    
                    <div class="feature-grid">
                        <div class="feature-card">
                            <h4><i class="bi bi-database"></i> Data Sources</h4>
                            <ul>
                                <li>Sales transactions (CSV)</li>
                                <li>Product catalog (Excel)</li>
                                <li>Customer database (SQL)</li>
                                <li>Market data (Web API)</li>
                            </ul>
                        </div>
                        
                        <div class="feature-card">
                            <h4><i class="bi bi-gear"></i> Processing Steps</h4>
                            <ul>
                                <li>Data loading and validation</li>
                                <li>Cleaning and transformation</li>
                                <li>Multi-source data merging</li>
                                <li>Statistical analysis</li>
                            </ul>
                        </div>
                        
                        <div class="feature-card">
                            <h4><i class="bi bi-graph-up"></i> Analysis Goals</h4>
                            <ul>
                                <li>Monthly sales trends</li>
                                <li>Regional performance</li>
                                <li>Product profitability</li>
                                <li>Customer segmentation</li>
                            </ul>
                        </div>
                        
                        <div class="feature-card">
                            <h4><i class="bi bi-file-earmark-text"></i> Outputs</h4>
                            <ul>
                                <li>Executive dashboard data</li>
                                <li>Detailed reports (Excel)</li>
                                <li>API-ready JSON exports</li>
                                <li>Statistical summaries</li>
                            </ul>
                        </div>
                    </div>
                </section>

                <!-- Complete Pipeline -->
                <section class="section" id="complete-pipeline">
                    <h2>?? Complete Analysis Pipeline</h2>
                    
                    <div class="code-example">
                        <h4>Full Implementation</h4>
                        <pre><code class="language-csharp">using System;
using System.IO;
using System.Threading.Tasks;
using Beep.Python.DataManagement;
using Microsoft.Extensions.Logging;

public class SalesAnalysisPipeline
{
    private readonly IPythonPandasManager _pandasManager;
    private readonly ILogger&lt;SalesAnalysisPipeline&gt; _logger;
    private readonly string _dataPath;
    private readonly string _outputPath;

    public SalesAnalysisPipeline(
        IPythonPandasManager pandasManager, 
        ILogger&lt;SalesAnalysisPipeline&gt; logger)
    {
        _pandasManager = pandasManager;
        _logger = logger;
        _dataPath = @"C:\Data\SalesAnalysis";
        _outputPath = @"C:\Output\SalesReports";
    }

    public async Task&lt;AnalysisResult&gt; RunCompleteAnalysis(string analystUserId)
    {
        var result = new AnalysisResult();
        var startTime = DateTime.Now;

        try
        {
            _logger.LogInformation("Starting sales analysis pipeline for user: {UserId}", analystUserId);

            // 1. INITIALIZATION AND SESSION SETUP
            _logger.LogInformation("Step 1: Configuring session and environment");
            await ConfigureAnalysisEnvironment(analystUserId);

            // 2. DATA LOADING FROM MULTIPLE SOURCES
            _logger.LogInformation("Step 2: Loading data from multiple sources");
            await LoadDataSources();

            // 3. DATA QUALITY ASSESSMENT
            _logger.LogInformation("Step 3: Assessing data quality");
            var qualityReport = await AssessDataQuality();
            result.DataQualityReport = qualityReport;

            // 4. DATA CLEANING AND PREPARATION
            _logger.LogInformation("Step 4: Cleaning and preparing data");
            await CleanAndPrepareData();

            // 5. DATA INTEGRATION AND MERGING
            _logger.LogInformation("Step 5: Integrating data sources");
            await IntegrateDataSources();

            // 6. FEATURE ENGINEERING
            _logger.LogInformation("Step 6: Creating analytical features");
            await CreateAnalyticalFeatures();

            // 7. STATISTICAL ANALYSIS
            _logger.LogInformation("Step 7: Performing statistical analysis");
            var statsResults = await PerformStatisticalAnalysis();
            result.StatisticalSummary = statsResults;

            // 8. BUSINESS INSIGHTS GENERATION
            _logger.LogInformation("Step 8: Generating business insights");
            var insights = await GenerateBusinessInsights();
            result.BusinessInsights = insights;

            // 9. REPORT GENERATION
            _logger.LogInformation("Step 9: Generating reports and exports");
            var reportPaths = await GenerateReports();
            result.ReportPaths = reportPaths;

            // 10. CLEANUP AND OPTIMIZATION
            _logger.LogInformation("Step 10: Cleaning up resources");
            await CleanupResources();

            result.Success = true;
            result.ExecutionTime = DateTime.Now - startTime;
            result.ProcessedRecords = GetProcessedRecordCount();

            _logger.LogInformation("Sales analysis pipeline completed successfully in {Duration}", 
                result.ExecutionTime);

            return result;
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Sales analysis pipeline failed");
            result.Success = false;
            result.ErrorMessage = ex.Message;
            result.ExecutionTime = DateTime.Now - startTime;
            return result;
        }
    }

    private async Task ConfigureAnalysisEnvironment(string userId)
    {
        // Configure dedicated session for analytics workload
        var configured = _pandasManager.ConfigureSessionForUser(userId, "sales-analytics-env");
        
        if (!configured)
        {
            throw new InvalidOperationException($"Failed to configure session for user: {userId}");
        }

        // Verify session is ready
        if (!_pandasManager.IsSessionConfigured())
        {
            throw new InvalidOperationException("Session configuration verification failed");
        }

        // Configure pandas for optimal performance
        _pandasManager.SetPandasOption("display.max_columns", "50");
        _pandasManager.SetPandasOption("display.precision", "2");
        _pandasManager.SetPandasOption("mode.chained_assignment", "None");

        _logger.LogInformation("Analysis environment configured successfully");
    }

    private async Task LoadDataSources()
    {
        // Load sales transactions from CSV
        var salesPath = Path.Combine(_dataPath, "sales_transactions_2024.csv");
        if (!File.Exists(salesPath))
        {
            throw new FileNotFoundException($"Sales data file not found: {salesPath}");
        }
        
        await _pandasManager.ReadCsvAsync("sales_raw", salesPath);
        _logger.LogInformation("Loaded sales transactions data");

        // Load product catalog from Excel
        var productsPath = Path.Combine(_dataPath, "product_catalog.xlsx");
        if (File.Exists(productsPath))
        {
            _pandasManager.ReadExcel("products_raw", productsPath);
            _logger.LogInformation("Loaded product catalog data");
        }

        // Load customer data from database
        var connectionString = GetDatabaseConnectionString();
        if (!string.IsNullOrEmpty(connectionString))
        {
            var customerQuery = @"
                SELECT CustomerID, CustomerName, Region, CustomerType, 
                       RegistrationDate, TotalLifetimeValue, IsActive
                FROM Customers 
                WHERE IsActive = 1";
            
            _pandasManager.ReadSql("customers_raw", customerQuery, connectionString);
            _logger.LogInformation("Loaded customer data from database");
        }

        // Load market data from web API
        try
        {
            var marketDataUrl = "https://api.marketdata.com/indicators/retail.json";
            _pandasManager.ReadFromWeb("market_data", marketDataUrl);
            _logger.LogInformation("Loaded market data from web API");
        }
        catch (Exception ex)
        {
            _logger.LogWarning("Failed to load market data: {Error}", ex.Message);
            // Continue without market data - create empty DataFrame
            _pandasManager.CreateDataFrame("market_data", "pd.DataFrame()");
        }
    }

    private async Task&lt;DataQualityReport&gt; AssessDataQuality()
    {
        var report = new DataQualityReport();

        // Check sales data quality
        var salesInfo = _pandasManager.Describe("sales_raw");
        var salesMissing = _pandasManager.IsNull("sales_raw");
        
        report.SalesDataSummary = salesInfo;
        report.SalesMissingValues = salesMissing;

        // Check for duplicates
        var originalCount = GetRowCount("sales_raw");
        _pandasManager.DropDuplicates("sales_raw", "sales_temp_dedup");
        var dedupCount = GetRowCount("sales_temp_dedup");
        
        report.SalesDuplicateCount = originalCount - dedupCount;
        report.HasDataQualityIssues = report.SalesDuplicateCount > 0 || !string.IsNullOrEmpty(salesMissing);

        _logger.LogInformation("Data quality assessment completed. Issues found: {HasIssues}", 
            report.HasDataQualityIssues);

        return report;
    }

    private async Task CleanAndPrepareData()
    {
        // Clean sales data
        _logger.LogInformation("Cleaning sales data...");
        
        // Remove duplicates
        _pandasManager.DropDuplicates("sales_raw", "sales_clean");
        
        // Handle missing values strategically
        _pandasManager.FilterRows("sales_clean", "sales_clean", 
            "Amount.notna() & CustomerID.notna() & OrderDate.notna()");
        
        // Convert data types
        _pandasManager.ConvertToDateTime("sales_clean", "OrderDate");
        _pandasManager.ConvertDataType("sales_clean", "Amount", "float64");
        _pandasManager.ConvertDataType("sales_clean", "Quantity", "int32");

        // Clean product data if available
        if (DataFrameExists("products_raw"))
        {
            _pandasManager.DropDuplicates("products_raw", "products_clean");
            _pandasManager.DropNA("products_clean", "products_clean");
        }

        // Clean customer data if available
        if (DataFrameExists("customers_raw"))
        {
            _pandasManager.DropDuplicates("customers_raw", "customers_clean");
            _pandasManager.ConvertToDateTime("customers_clean", "RegistrationDate");
        }

        _logger.LogInformation("Data cleaning completed");
    }

    private async Task IntegrateDataSources()
    {
        _logger.LogInformation("Integrating data sources...");

        // Start with clean sales data
        var currentDataFrame = "sales_clean";

        // Merge with products if available
        if (DataFrameExists("products_clean"))
        {
            _pandasManager.MergeDataFrames("sales_clean", "products_clean", 
                "sales_with_products", "ProductID");
            currentDataFrame = "sales_with_products";
            _logger.LogInformation("Merged sales data with product catalog");
        }

        // Merge with customers if available
        if (DataFrameExists("customers_clean"))
        {
            _pandasManager.MergeDataFrames(currentDataFrame, "customers_clean", 
                "integrated_data", "CustomerID");
            currentDataFrame = "integrated_data";
            _logger.LogInformation("Merged data with customer information");
        }
        else
        {
            // Rename for consistency
            _pandasManager.CreateDataFrame("integrated_data", currentDataFrame);
        }

        _logger.LogInformation("Data integration completed. Final dataset: {DataFrame}", currentDataFrame);
    }

    private async Task CreateAnalyticalFeatures()
    {
        _logger.LogInformation("Creating analytical features...");

        // Time-based features
        _pandasManager.AddColumn("integrated_data", "Year", "OrderDate.dt.year");
        _pandasManager.AddColumn("integrated_data", "Month", "OrderDate.dt.month");
        _pandasManager.AddColumn("integrated_data", "Quarter", "OrderDate.dt.quarter");
        _pandasManager.AddColumn("integrated_data", "DayOfWeek", "OrderDate.dt.dayofweek");
        _pandasManager.AddColumn("integrated_data", "WeekOfYear", "OrderDate.dt.isocalendar().week");

        // Business metrics
        _pandasManager.AddColumn("integrated_data", "Revenue", "Amount * Quantity");
        
        // Add cost and profit if product data available
        if (HasColumn("integrated_data", "UnitCost"))
        {
            _pandasManager.AddColumn("integrated_data", "TotalCost", "UnitCost * Quantity");
            _pandasManager.AddColumn("integrated_data", "Profit", "Revenue - TotalCost");
            _pandasManager.AddColumn("integrated_data", "ProfitMargin", "(Profit / Revenue) * 100");
        }

        // Customer lifetime value calculation if customer data available
        if (HasColumn("integrated_data", "TotalLifetimeValue"))
        {
            _pandasManager.AddColumn("integrated_data", "CustomerValueSegment", 
                @"pd.cut(TotalLifetimeValue, 
                        bins=[0, 1000, 5000, 10000, float('inf')], 
                        labels=['Low', 'Medium', 'High', 'Premium'])");
        }

        // Seasonal indicators
        _pandasManager.AddColumn("integrated_data", "Season", 
            @"np.where(Month.isin([12, 1, 2]), 'Winter',
                np.where(Month.isin([3, 4, 5]), 'Spring',
                  np.where(Month.isin([6, 7, 8]), 'Summer', 'Fall')))");

        _logger.LogInformation("Analytical features created successfully");
    }

    private async Task&lt;StatisticalSummary&gt; PerformStatisticalAnalysis()
    {
        _logger.LogInformation("Performing statistical analysis...");

        var summary = new StatisticalSummary();

        // Overall descriptive statistics
        summary.OverallStatistics = _pandasManager.Describe("integrated_data");
        summary.CorrelationMatrix = _pandasManager.Correlation("integrated_data");

        // Revenue analysis
        summary.TotalRevenue = _pandasManager.CalculateMean("integrated_data", "Revenue");
        summary.MedianRevenue = _pandasManager.CalculateMedian("integrated_data", "Revenue");

        // Time-based analysis
        _pandasManager.GroupBy("integrated_data", "monthly_performance", "Month", "sum");
        _pandasManager.GroupBy("integrated_data", "quarterly_performance", "Quarter", "sum");

        // Regional analysis if region data available
        if (HasColumn("integrated_data", "Region"))
        {
            _pandasManager.GroupBy("integrated_data", "regional_performance", "Region", "sum");
            summary.TopRegion = _pandasManager.ValueCounts("integrated_data", "Region");
        }

        // Product performance if product data available
        if (HasColumn("integrated_data", "ProductCategory"))
        {
            _pandasManager.GroupBy("integrated_data", "category_performance", "ProductCategory", "sum");
            summary.TopCategory = _pandasManager.ValueCounts("integrated_data", "ProductCategory");
        }

        // Customer analysis
        if (HasColumn("integrated_data", "CustomerType"))
        {
            _pandasManager.GroupBy("integrated_data", "customer_type_analysis", "CustomerType", "mean");
            summary.CustomerDistribution = _pandasManager.ValueCounts("integrated_data", "CustomerType");
        }

        _logger.LogInformation("Statistical analysis completed");
        return summary;
    }

    private async Task&lt;BusinessInsights&gt; GenerateBusinessInsights()
    {
        _logger.LogInformation("Generating business insights...");

        var insights = new BusinessInsights();

        // Sales trends analysis
        _pandasManager.PivotTable("integrated_data", "monthly_trends", 
            "Month", "Year", "Revenue");
        
        // Create rolling averages for trend analysis
        _pandasManager.RollingWindow("monthly_performance", "monthly_ma", 3, "mean");

        // Seasonal analysis
        _pandasManager.GroupBy("integrated_data", "seasonal_analysis", "Season", "sum");

        // Top performers identification
        if (HasColumn("integrated_data", "ProductID"))
        {
            _pandasManager.GroupBy("integrated_data", "top_products", "ProductID", "sum");
            // Get top 10 products
            _pandasManager.FilterRows("top_products", "top_10_products", 
                "Revenue >= " + GetPercentileValue("top_products", "Revenue", 90));
        }

        // Customer segmentation
        if (HasColumn("integrated_data", "CustomerValueSegment"))
        {
            _pandasManager.GroupBy("integrated_data", "customer_segments", "CustomerValueSegment", "sum");
            _pandasManager.PivotTable("integrated_data", "customer_behavior", 
                "CustomerValueSegment", "Season", "Revenue");
        }

        // Growth analysis (if multiple years available)
        var yearlyComparison = CreateYearOverYearAnalysis();
        insights.YearOverYearGrowth = yearlyComparison;

        _logger.LogInformation("Business insights generated successfully");
        return insights;
    }

    private async Task&lt;Dictionary&lt;string, string&gt;&gt; GenerateReports()
    {
        _logger.LogInformation("Generating reports and exports...");

        var reportPaths = new Dictionary&lt;string, string&gt;();

        // Ensure output directory exists
        Directory.CreateDirectory(_outputPath);

        // Executive summary report (CSV)
        var executivePath = Path.Combine(_outputPath, "executive_summary.csv");
        _pandasManager.ToCsv("monthly_performance", executivePath);
        reportPaths["ExecutiveSummary"] = executivePath;

        // Detailed monthly analysis (Excel)
        var monthlyPath = Path.Combine(_outputPath, "monthly_analysis.xlsx");
        _pandasManager.ToExcel("monthly_trends", monthlyPath);
        reportPaths["MonthlyAnalysis"] = monthlyPath;

        // Regional performance report
        if (DataFrameExists("regional_performance"))
        {
            var regionalPath = Path.Combine(_outputPath, "regional_performance.csv");
            _pandasManager.ToCsv("regional_performance", regionalPath);
            reportPaths["RegionalPerformance"] = regionalPath;
        }

        // Customer segmentation analysis
        if (DataFrameExists("customer_segments"))
        {
            var customerPath = Path.Combine(_outputPath, "customer_analysis.xlsx");
            _pandasManager.ToExcel("customer_segments", customerPath);
            reportPaths["CustomerAnalysis"] = customerPath;
        }

        // API-ready JSON exports
        var dashboardData = new
        {
            MonthlyTrends = _pandasManager.GetDataFrameAsJson("monthly_performance"),
            RegionalData = DataFrameExists("regional_performance") ? 
                _pandasManager.GetDataFrameAsJson("regional_performance") : null,
            CustomerSegments = DataFrameExists("customer_segments") ? 
                _pandasManager.GetDataFrameAsJson("customer_segments") : null
        };

        var jsonPath = Path.Combine(_outputPath, "dashboard_data.json");
        await File.WriteAllTextAsync(jsonPath, 
            System.Text.Json.JsonSerializer.Serialize(dashboardData, new JsonSerializerOptions 
            { 
                WriteIndented = true 
            }));
        reportPaths["DashboardData"] = jsonPath;

        _logger.LogInformation("Reports generated successfully. Output directory: {OutputPath}", _outputPath);
        return reportPaths;
    }

    private async Task CleanupResources()
    {
        _logger.LogInformation("Cleaning up analysis resources...");

        // Get memory usage before cleanup
        var memoryBefore = _pandasManager.GetMemoryUsageReport();
        _logger.LogInformation("Memory usage before cleanup: {MemoryUsage}", memoryBefore);

        // Cleanup intermediate DataFrames (keep final results)
        var cleanup = new[]
        {
            "sales_raw", "products_raw", "customers_raw", "market_data",
            "sales_temp_dedup", "sales_with_products"
        };

        // Clean up old DataFrames
        _pandasManager.CleanupIdleDataFrames(5); // Clean DataFrames older than 5 minutes

        // Get memory usage after cleanup
        var memoryAfter = _pandasManager.GetMemoryUsageReport();
        _logger.LogInformation("Memory usage after cleanup: {MemoryUsage}", memoryAfter);

        _logger.LogInformation("Resource cleanup completed");
    }

    // Helper methods
    private bool DataFrameExists(string dataFrameName)
    {
        try
        {
            var shape = _pandasManager.GetDataFrameAsJson(dataFrameName);
            return !string.IsNullOrEmpty(shape);
        }
        catch
        {
            return false;
        }
    }

    private bool HasColumn(string dataFrameName, string columnName)
    {
        // Implementation would check if column exists in DataFrame
        // Simplified for example
        return true;
    }

    private int GetRowCount(string dataFrameName)
    {
        // Implementation would get actual row count
        // Simplified for example
        return 1000;
    }

    private int GetProcessedRecordCount()
    {
        return GetRowCount("integrated_data");
    }

    private string GetDatabaseConnectionString()
    {
        return "Server=localhost;Database=SalesDB;Trusted_Connection=true;";
    }

    private string GetPercentileValue(string dataFrameName, string columnName, int percentile)
    {
        // Would calculate actual percentile value
        return "1000";
    }

    private string CreateYearOverYearAnalysis()
    {
        // Implementation for year-over-year growth calculation
        return "15.2% growth year-over-year";
    }
}

// Supporting classes
public class AnalysisResult
{
    public bool Success { get; set; }
    public TimeSpan ExecutionTime { get; set; }
    public string ErrorMessage { get; set; }
    public DataQualityReport DataQualityReport { get; set; }
    public StatisticalSummary StatisticalSummary { get; set; }
    public BusinessInsights BusinessInsights { get; set; }
    public Dictionary&lt;string, string&gt; ReportPaths { get; set; }
    public int ProcessedRecords { get; set; }
}

public class DataQualityReport
{
    public string SalesDataSummary { get; set; }
    public string SalesMissingValues { get; set; }
    public int SalesDuplicateCount { get; set; }
    public bool HasDataQualityIssues { get; set; }
}

public class StatisticalSummary
{
    public string OverallStatistics { get; set; }
    public string CorrelationMatrix { get; set; }
    public string TotalRevenue { get; set; }
    public string MedianRevenue { get; set; }
    public string TopRegion { get; set; }
    public string TopCategory { get; set; }
    public string CustomerDistribution { get; set; }
}

public class BusinessInsights
{
    public string YearOverYearGrowth { get; set; }
    public string SeasonalTrends { get; set; }
    public string TopPerformers { get; set; }
    public string CustomerBehavior { get; set; }
}</code></pre>
                    </div>
                </section>

                <!-- Usage Example -->
                <section class="section" id="usage-example">
                    <h2>?? Using the Pipeline</h2>
                    
                    <div class="code-example">
                        <h4>Integration with ASP.NET Core</h4>
                        <pre><code class="language-csharp">// In your controller or service
[ApiController]
[Route("api/[controller]")]
public class AnalyticsController : ControllerBase
{
    private readonly SalesAnalysisPipeline _analysisPipeline;
    private readonly ILogger&lt;AnalyticsController&gt; _logger;

    public AnalyticsController(
        SalesAnalysisPipeline analysisPipeline,
        ILogger&lt;AnalyticsController&gt; logger)
    {
        _analysisPipeline = analysisPipeline;
        _logger = logger;
    }

    [HttpPost("run-analysis")]
    public async Task&lt;IActionResult&gt; RunSalesAnalysis([FromBody] AnalysisRequest request)
    {
        try
        {
            _logger.LogInformation("Starting sales analysis for user: {UserId}", request.UserId);

            var result = await _analysisPipeline.RunCompleteAnalysis(request.UserId);

            if (result.Success)
            {
                return Ok(new
                {
                    success = true,
                    executionTime = result.ExecutionTime.TotalMinutes,
                    processedRecords = result.ProcessedRecords,
                    reportPaths = result.ReportPaths,
                    summary = new
                    {
                        totalRevenue = result.StatisticalSummary?.TotalRevenue,
                        topRegion = result.StatisticalSummary?.TopRegion,
                        yearOverYearGrowth = result.BusinessInsights?.YearOverYearGrowth
                    }
                });
            }
            else
            {
                return BadRequest(new
                {
                    success = false,
                    error = result.ErrorMessage
                });
            }
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Sales analysis failed");
            return StatusCode(500, new { error = "Analysis pipeline failed" });
        }
    }

    [HttpGet("reports/{reportType}")]
    public async Task&lt;IActionResult&gt; GetReport(string reportType)
    {
        // Implementation to serve generated reports
        var reportPath = Path.Combine(@"C:\Output\SalesReports", $"{reportType}.csv");
        
        if (System.IO.File.Exists(reportPath))
        {
            var bytes = await System.IO.File.ReadAllBytesAsync(reportPath);
            return File(bytes, "text/csv", $"{reportType}.csv");
        }
        
        return NotFound();
    }
}

public class AnalysisRequest
{
    public string UserId { get; set; }
    public DateTime? StartDate { get; set; }
    public DateTime? EndDate { get; set; }
    public string[] Regions { get; set; }
}</code></pre>
                    </div>
                </section>

                <!-- Dependency Injection Setup -->
                <section class="section" id="di-setup">
                    <h2>?? Dependency Injection Setup</h2>
                    
                    <div class="code-example">
                        <h4>Program.cs Configuration</h4>
                        <pre><code class="language-csharp">// Program.cs for .NET 6+
var builder = WebApplication.CreateBuilder(args);

// Add services to the container
builder.Services.AddControllers();
builder.Services.AddLogging();

// Register BEEP Python services
builder.Services.AddSingleton&lt;IBeepService, BeepService&gt;();
builder.Services.AddSingleton&lt;IPythonRunTimeManager, PythonRunTimeManager&gt;();
builder.Services.AddSingleton&lt;IPythonCodeExecuteManager, PythonCodeExecuteManager&gt;();

// Register DataManagement services
builder.Services.AddTransient&lt;IPythonPandasManager, PythonPandasManager&gt;();
builder.Services.AddScoped&lt;SalesAnalysisPipeline&gt;();

// Add configuration
builder.Services.Configure&lt;PythonConfiguration&gt;(
    builder.Configuration.GetSection("Python"));

var app = builder.Build();

// Configure the HTTP request pipeline
if (app.Environment.IsDevelopment())
{
    app.UseDeveloperExceptionPage();
}

app.UseHttpsRedirection();
app.UseAuthorization();
app.MapControllers();

app.Run();</code></pre>
                    </div>

                    <div class="code-example">
                        <h4>Configuration (appsettings.json)</h4>
                        <pre><code class="language-json">{
  "Python": {
    "PythonDLLPath": "C:\\Python39\\python39.dll",
    "PythonHomePath": "C:\\Python39",
    "VirtualEnvironmentPath": "C:\\Environments",
    "DefaultEnvironment": "sales-analytics-env",
    "SessionTimeout": "01:00:00",
    "MaxConcurrentSessions": 10
  },
  "DataAnalysis": {
    "DataPath": "C:\\Data\\SalesAnalysis",
    "OutputPath": "C:\\Output\\SalesReports",
    "DatabaseConnectionString": "Server=localhost;Database=SalesDB;Trusted_Connection=true;",
    "CleanupInterval": "00:30:00"
  },
  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "Beep.Python": "Debug",
      "SalesAnalysisPipeline": "Information"
    }
  }
}</code></pre>
                    </div>
                </section>

                <!-- Monitoring and Optimization -->
                <section class="section" id="monitoring">
                    <h2>?? Monitoring and Optimization</h2>
                    
                    <div class="code-example">
                        <h4>Performance Monitoring Service</h4>
                        <pre><code class="language-csharp">public class AnalysisMonitoringService : BackgroundService
{
    private readonly IServiceProvider _serviceProvider;
    private readonly ILogger&lt;AnalysisMonitoringService&gt; _logger;
    private readonly IConfiguration _configuration;

    public AnalysisMonitoringService(
        IServiceProvider serviceProvider,
        ILogger&lt;AnalysisMonitoringService&gt; logger,
        IConfiguration configuration)
    {
        _serviceProvider = serviceProvider;
        _logger = logger;
        _configuration = configuration;
    }

    protected override async Task ExecuteAsync(CancellationToken stoppingToken)
    {
        var interval = _configuration.GetValue&lt;TimeSpan&gt;("DataAnalysis:CleanupInterval");
        
        while (!stoppingToken.IsCancellationRequested)
        {
            try
            {
                using var scope = _serviceProvider.CreateScope();
                var pandasManager = scope.ServiceProvider.GetRequiredService&lt;IPythonPandasManager&gt;();

                // Monitor memory usage
                var memoryReport = pandasManager.GetMemoryUsageReport();
                _logger.LogInformation("Current memory usage: {MemoryReport}", memoryReport);

                // Cleanup idle DataFrames
                pandasManager.CleanupIdleDataFrames(30);
                _logger.LogInformation("Performed cleanup of idle DataFrames");

                // Log session statistics
                LogSessionStatistics(pandasManager);

                await Task.Delay(interval, stoppingToken);
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, "Error in monitoring service");
                await Task.Delay(TimeSpan.FromMinutes(5), stoppingToken);
            }
        }
    }

    private void LogSessionStatistics(IPythonPandasManager pandasManager)
    {
        try
        {
            var session = pandasManager.GetConfiguredSession();
            var environment = pandasManager.GetConfiguredVirtualEnvironment();

            if (session != null && environment != null)
            {
                _logger.LogInformation("Active session: {SessionId}, User: {Username}, Environment: {EnvironmentName}",
                    session.SessionId, session.Username, environment.Name);
            }
        }
        catch (Exception ex)
        {
            _logger.LogWarning(ex, "Failed to retrieve session statistics");
        }
    }
}</code></pre>
                    </div>
                </section>

                <!-- Best Practices -->
                <section class="section" id="best-practices">
                    <h2>? Best Practices Demonstrated</h2>
                    
                    <div class="feature-grid">
                        <div class="feature-card">
                            <h4><i class="bi bi-shield-check"></i> Error Handling</h4>
                            <ul>
                                <li>Comprehensive try-catch blocks</li>
                                <li>Graceful handling of missing data sources</li>
                                <li>Validation before operations</li>
                                <li>Proper logging throughout pipeline</li>
                            </ul>
                        </div>
                        
                        <div class="feature-card">
                            <h4><i class="bi bi-speedometer2"></i> Performance</h4>
                            <ul>
                                <li>Async operations where beneficial</li>
                                <li>Memory monitoring and cleanup</li>
                                <li>Efficient data type conversions</li>
                                <li>Resource optimization strategies</li>
                            </ul>
                        </div>
                        
                        <div class="feature-card">
                            <h4><i class="bi bi-gear"></i> Maintainability</h4>
                            <ul>
                                <li>Modular step-by-step approach</li>
                                <li>Clear separation of concerns</li>
                                <li>Comprehensive logging</li>
                                <li>Configuration-driven parameters</li>
                            </ul>
                        </div>
                        
                        <div class="feature-card">
                            <h4><i class="bi bi-people"></i> Enterprise Ready</h4>
                            <ul>
                                <li>User-specific session management</li>
                                <li>Dependency injection integration</li>
                                <li>Background service monitoring</li>
                                <li>Multiple output format support</li>
                            </ul>
                        </div>
                    </div>
                </section>

                <!-- Expected Outputs -->
                <section class="section" id="outputs">
                    <h2>?? Expected Outputs</h2>
                    
                    <div class="highlight-box">
                        <h4>Generated Reports and Data</h4>
                        <ul>
                            <li><strong>executive_summary.csv:</strong> Monthly performance metrics for executive dashboard</li>
                            <li><strong>monthly_analysis.xlsx:</strong> Detailed month-by-month breakdown with trends</li>
                            <li><strong>regional_performance.csv:</strong> Sales performance by geographic region</li>
                            <li><strong>customer_analysis.xlsx:</strong> Customer segmentation and behavior analysis</li>
                            <li><strong>dashboard_data.json:</strong> API-ready data for web dashboards</li>
                        </ul>
                    </div>

                    <div class="note">
                        <strong>?? Statistical Insights Generated:</strong>
                        <ul>
                            <li>Revenue trends and growth patterns</li>
                            <li>Seasonal performance variations</li>
                            <li>Regional and product profitability analysis</li>
                            <li>Customer lifetime value segmentation</li>
                            <li>Year-over-year performance comparisons</li>
                        </ul>
                    </div>
                </section>

                <!-- Navigation Links -->
                <div class="nav-links">
                    <a href="../getting-started.html" class="btn-beep">
                        <i class="bi bi-arrow-left"></i> Getting Started
                    </a>
                    <a href="business-intelligence.html" class="btn-beep">
                        <i class="bi bi-arrow-right"></i> BI Examples
                    </a>
                </div>

                <!-- Footer -->
                <footer class="documentation-footer">
                    <div class="footer-content">
                        <div class="footer-copyright">
                            <p>&copy; 2024 The Tech Idea - Beep.Python.DataManagement Documentation</p>
                        </div>
                        <div class="footer-links">
                            <a href="../index.html">Home</a>
                            <a href="../getting-started.html">Getting Started</a>
                            <a href="../api/PythonPandasManager.html">API Reference</a>
                        </div>
                    </div>
                </footer>
            </div>
        </main>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script src="../assets/navigation.js"></script>
</body>
</html>