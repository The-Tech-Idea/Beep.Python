<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AzureTransformerPipeline - Beep.Python.AI.Transformers API</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet">
    <link href="../assets/styles.css" rel="stylesheet">
</head>
<body>
    <!-- Mobile Menu Toggle -->
    <button class="mobile-menu-toggle" onclick="toggleSidebar()">
        <i class="bi bi-list"></i>
    </button>

    <!-- Theme Toggle -->
    <button class="theme-toggle" onclick="toggleTheme()" title="Toggle theme">
        <i class="bi bi-sun-fill" id="theme-icon"></i>
    </button>

    <div class="container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <!-- Navigation will be loaded dynamically by navigation.js -->
        </aside>

        <!-- Main Content -->
        <main class="content">
            <div class="content-wrapper">
                <!-- Breadcrumb Navigation -->
                <div class="breadcrumb-nav">
                    <a href="../index.html">Home</a>
                    <span>›</span>
                    <a href="../index.html#providers">AI Providers</a>
                    <span>›</span>
                    <span>Azure OpenAI</span>
                </div>

                <!-- Page Header -->
                <div class="page-header">
                    <h1><i class="bi bi-cloud"></i> AzureTransformerPipeline</h1>
                    <p class="page-subtitle">Enterprise-grade OpenAI models hosted on Microsoft Azure with enhanced security and compliance</p>
                </div>

                <!-- Class Info -->
                <div class="class-info">
                    <div class="class-namespace">
                        <strong>Namespace:</strong> Beep.Python.AI.Transformers<br>
                        <strong>Assembly:</strong> Beep.Python.AI.Transformers.dll
                    </div>
                    <div class="class-implements">
                        <strong>Inheritance:</strong> BaseTransformerPipeline ? AzureTransformerPipeline<br>
                        <strong>Implements:</strong> ITransformerPipeLine, IDisposable
                    </div>
                </div>

                <!-- Overview -->
                <section class="section" id="overview">
                    <h2>Overview</h2>
                    <p>
                        The <code>AzureTransformerPipeline</code> provides access to OpenAI models through Microsoft Azure's 
                        OpenAI Service. This enterprise-focused solution offers enhanced security, compliance, and 
                        data residency features while maintaining the same powerful capabilities as OpenAI's models.
                    </p>
                    
                    <div class="highlight-box bg-light p-4 rounded">
                        <h5><i class="bi bi-lightbulb"></i> Enterprise Advantages</h5>
                        <ul class="mb-0">
                            <li><strong>Data Residency</strong> - Your data stays in your chosen Azure region</li>
                            <li><strong>Enterprise Security</strong> - Azure AD integration and VNet support</li>
                            <li><strong>SLA Guarantees</strong> - 99.9% uptime with Azure SLA</li>
                            <li><strong>Compliance</strong> - SOC 2, HIPAA, ISO 27001 certified</li>
                            <li><strong>Cost Control</strong> - Predictable pricing and budgeting</li>
                        </ul>
                    </div>
                </section>

                <!-- Configuration -->
                <section class="section" id="configuration">
                    <h2>Configuration</h2>
                    
                    <h3>AzureOpenAIConnectionConfig</h3>
                    <div class="code-example">
                        <h4>Basic Configuration</h4>
                        <pre><code class="language-csharp">var config = new AzureOpenAIConnectionConfig
{
    Endpoint = "https://your-resource.openai.azure.com/",
    ApiKey = "your-azure-openai-api-key",
    ApiVersion = "2024-02-01",
    DeploymentName = "gpt-35-turbo",          // Your deployed model
    TimeoutSeconds = 90,
    MaxRetries = 3
};</code></pre>
                    </div>

                    <h3>Azure AD Authentication</h3>
                    <div class="code-example">
                        <h4>Enterprise Authentication</h4>
                        <pre><code class="language-csharp">var azureAdConfig = new AzureOpenAIConnectionConfig
{
    Endpoint = "https://your-resource.openai.azure.com/",
    ApiVersion = "2024-02-01",
    DeploymentName = "gpt-4",
    
    // Azure AD authentication instead of API key
    AuthenticationConfig = new AzureAuthenticationConfig
    {
        TenantId = "your-tenant-id",
        ClientId = "your-client-id",
        ClientSecret = GetClientSecret(),      // Or use certificate
        Scope = "https://cognitiveservices.azure.com/.default"
    },
    
    // Enterprise features
    EnterpriseConfig = new AzureEnterpriseConfig
    {
        ResourceGroupName = "openai-rg",
        SubscriptionId = "your-subscription-id",
        EnablePrivateEndpoint = true,
        VNetName = "enterprise-vnet",
        SubnetName = "openai-subnet"
    }
};</code></pre>
                    </div>

                    <h3>Multi-Region Setup</h3>
                    <div class="code-example">
                        <h4>Geographic Distribution</h4>
                        <pre><code class="language-csharp">var multiRegionConfig = new AzureOpenAIConnectionConfig
{
    PrimaryEndpoint = "https://eastus-openai.openai.azure.com/",
    FallbackEndpoints = new[]
    {
        "https://westus-openai.openai.azure.com/",
        "https://northeurope-openai.openai.azure.com/"
    },
    
    RegionConfig = new RegionConfig
    {
        PreferredRegion = "East US",
        EnableAutomaticFailover = true,
        FailoverTimeoutSeconds = 30,
        DataResidencyRequirement = "United States"
    },
    
    LoadBalancingConfig = new LoadBalancingConfig
    {
        Strategy = LoadBalancingStrategy.LatencyBased,
        HealthCheckIntervalSeconds = 60,
        EnableRegionAffinity = true
    }
};</code></pre>
                    </div>
                </section>

                <!-- Deployment Management -->
                <section class="section" id="deployments">
                    <h2>Deployment Management</h2>
                    
                    <div class="tip">
                        <strong>?? Azure OpenAI Deployments</strong>
                        <p>Azure OpenAI requires you to create deployments for each model you want to use. 
                        Each deployment has its own name and can be configured with different parameters.</p>
                    </div>

                    <div class="code-example">
                        <h4>Multiple Deployment Configuration</h4>
                        <pre><code class="language-csharp">public class AzureDeploymentManager
{
    private readonly Dictionary<string, AzureOpenAIConnectionConfig> _deployments;

    public AzureDeploymentManager()
    {
        _deployments = new Dictionary<string, AzureOpenAIConnectionConfig>
        {
            ["gpt-4"] = new AzureOpenAIConnectionConfig
            {
                Endpoint = "https://your-resource.openai.azure.com/",
                ApiKey = GetApiKey(),
                ApiVersion = "2024-02-01",
                DeploymentName = "gpt-4-deployment",
                MaxTokensPerRequest = 8192
            },
            ["gpt-35-turbo"] = new AzureOpenAIConnectionConfig
            {
                Endpoint = "https://your-resource.openai.azure.com/",
                ApiKey = GetApiKey(),
                ApiVersion = "2024-02-01",
                DeploymentName = "gpt-35-turbo-deployment",
                MaxTokensPerRequest = 4096
            },
            ["text-embedding"] = new AzureOpenAIConnectionConfig
            {
                Endpoint = "https://your-resource.openai.azure.com/",
                ApiKey = GetApiKey(),
                ApiVersion = "2024-02-01",
                DeploymentName = "text-embedding-ada-002",
                MaxTokensPerRequest = 8191
            }
        };
    }

    public async Task<ITransformerPipeLine> GetPipelineForModelAsync(string modelType)
    {
        if (!_deployments.ContainsKey(modelType))
            throw new ArgumentException($"No deployment configured for model: {modelType}");

        var config = _deployments[modelType];
        var pipeline = TransformerPipelineFactory.CreateAzureOpenAIPipeline(
            runtimeManager, executeManager, config);

        await pipeline.InitializeAsync(new TransformerPipelineConfig
        {
            TaskType = GetTaskTypeForModel(modelType)
        });

        await pipeline.LoadModelAsync(new TransformerModelInfo
        {
            Name = config.DeploymentName,
            Source = TransformerModelSource.Azure
        }, GetTaskTypeForModel(modelType));

        return pipeline;
    }
}</code></pre>
                    </div>

                    <h3>Deployment Health Monitoring</h3>
                    <div class="code-example">
                        <h4>Monitor Deployment Status</h4>
                        <pre><code class="language-csharp">public class AzureDeploymentHealthMonitor
{
    public async Task<DeploymentHealthStatus> CheckDeploymentHealthAsync(
        AzureOpenAIConnectionConfig config)
    {
        try
        {
            // Test deployment with a simple request
            var pipeline = TransformerPipelineFactory.CreateAzureOpenAIPipeline(
                runtimeManager, executeManager, config);

            var testResult = await pipeline.GenerateTextAsync(
                "Test", 
                new TextGenerationParameters { MaxTokens = 1 });

            return new DeploymentHealthStatus
            {
                IsHealthy = testResult.Success,
                ResponseTimeMs = testResult.ExecutionTimeMs,
                LastChecked = DateTime.UtcNow,
                Region = ExtractRegionFromEndpoint(config.Endpoint),
                DeploymentName = config.DeploymentName
            };
        }
        catch (Exception ex)
        {
            return new DeploymentHealthStatus
            {
                IsHealthy = false,
                ErrorMessage = ex.Message,
                LastChecked = DateTime.UtcNow
            };
        }
    }

    public async Task<List<DeploymentHealthStatus>> MonitorAllDeploymentsAsync()
    {
        var healthStatuses = new List<DeploymentHealthStatus>();
        
        foreach (var deployment in _deployments.Values)
        {
            var status = await CheckDeploymentHealthAsync(deployment);
            healthStatuses.Add(status);
            
            // Log unhealthy deployments
            if (!status.IsHealthy)
            {
                _logger.LogWarning("Deployment {Deployment} in {Region} is unhealthy: {Error}",
                    status.DeploymentName, status.Region, status.ErrorMessage);
            }
        }

        return healthStatuses;
    }
}</code></pre>
                    </div>
                </section>

                <!-- Usage Examples -->
                <section class="section" id="examples">
                    <h2>Usage Examples</h2>
                    
                    <h3>Basic Text Generation</h3>
                    <div class="code-example">
                        <h4>Enterprise Text Generation</h4>
                        <pre><code class="language-csharp">// Create Azure OpenAI pipeline
var config = new AzureOpenAIConnectionConfig
{
    Endpoint = "https://eastus-openai.openai.azure.com/",
    ApiKey = GetSecureApiKey(),
    ApiVersion = "2024-02-01",
    DeploymentName = "gpt-4-32k",
    TimeoutSeconds = 120
};

var pipeline = TransformerPipelineFactory.CreateAzureOpenAIPipeline(
    runtimeManager, executeManager, config);

await pipeline.InitializeAsync(new TransformerPipelineConfig
{
    TaskType = TransformerTask.TextGeneration
});

await pipeline.LoadModelAsync(new TransformerModelInfo
{
    Name = "gpt-4-32k",
    Source = TransformerModelSource.Azure
}, TransformerTask.TextGeneration);

// Generate with compliance logging
var result = await pipeline.GenerateTextAsync(
    "Analyze the quarterly financial data and provide insights",
    new TextGenerationParameters
    {
        MaxTokens = 2000,
        Temperature = 0.3,  // Lower temperature for business analysis
        ComplianceConfig = new ComplianceConfig
        {
            EnableAuditLogging = true,
            DataClassification = "Confidential",
            RetentionPeriodDays = 90
        }
    });

// Log for compliance
await LogComplianceEvent(new ComplianceEvent
{
    UserId = currentUser.Id,
    Action = "TextGeneration",
    DataClassification = "Confidential",
    Timestamp = DateTime.UtcNow,
    ResourceId = config.DeploymentName
});

Console.WriteLine(result.Data);</code></pre>
                    </div>

                    <h3>Secure Chat Implementation</h3>
                    <div class="code-example">
                        <h4>Enterprise Chat with Audit Trail</h4>
                        <pre><code class="language-csharp">public class SecureAzureChatService
{
    private readonly IAuditLogger _auditLogger;
    private readonly IDataClassifier _dataClassifier;

    public async Task<string> SecureChatAsync(
        string userMessage, 
        string userId, 
        SecurityContext securityContext)
    {
        // Classify data before processing
        var classification = await _dataClassifier.ClassifyAsync(userMessage);
        
        if (classification.Level == DataClassificationLevel.Restricted)
        {
            throw new SecurityException("Message contains restricted content");
        }

        // Configure pipeline for user's security level
        var config = GetConfigForSecurityLevel(securityContext.SecurityLevel);
        var pipeline = TransformerPipelineFactory.CreateAzureOpenAIPipeline(
            runtimeManager, executeManager, config);

        await pipeline.InitializeAsync(new TransformerPipelineConfig
        {
            TaskType = TransformerTask.ChatCompletion,
            SecurityConfig = new SecurityConfig
            {
                EnableContentFiltering = true,
                EnablePIIDetection = true,
                AllowedContentTypes = securityContext.AllowedContentTypes
            }
        });

        // Create secure conversation context
        var conversation = new SecureConversationContext
        {
            UserId = userId,
            SecurityLevel = securityContext.SecurityLevel,
            EncryptionEnabled = true,
            AuditEnabled = true
        };

        conversation.AddUserMessage(userMessage, classification);

        try
        {
            var response = await pipeline.ChatAsync(conversation, new ChatParameters
            {
                Temperature = 0.1,  // Conservative for business use
                MaxTokens = 1000,
                EnableContentFiltering = true
            });

            // Audit the interaction
            await _auditLogger.LogInteractionAsync(new ChatAuditEvent
            {
                UserId = userId,
                Timestamp = DateTime.UtcNow,
                InputClassification = classification.Level,
                OutputLength = response.Data.Message.Length,
                DeploymentUsed = config.DeploymentName,
                SecurityLevel = securityContext.SecurityLevel
            });

            conversation.AddAssistantMessage(response.Data.Message);
            return response.Data.Message;
        }
        catch (Exception ex)
        {
            // Log security events
            await _auditLogger.LogSecurityEventAsync(new SecurityAuditEvent
            {
                UserId = userId,
                EventType = "ChatError",
                ErrorMessage = ex.Message,
                Timestamp = DateTime.UtcNow
            });
            throw;
        }
    }

    private AzureOpenAIConnectionConfig GetConfigForSecurityLevel(SecurityLevel level)
    {
        return level switch
        {
            SecurityLevel.High => new AzureOpenAIConnectionConfig
            {
                Endpoint = "https://secured-openai.openai.azure.com/",
                DeploymentName = "gpt-4-secure",
                EnablePrivateEndpoint = true,
                EnableContentFiltering = true
            },
            SecurityLevel.Standard => new AzureOpenAIConnectionConfig
            {
                Endpoint = "https://standard-openai.openai.azure.com/",
                DeploymentName = "gpt-35-turbo",
                EnableContentFiltering = true
            },
            _ => throw new ArgumentException("Invalid security level")
        };
    }
}</code></pre>
                    </div>

                    <h3>Cost-Optimized Processing</h3>
                    <div class="code-example">
                        <h4>Smart Model Selection</h4>
                        <pre><code class="language-csharp">public class CostOptimizedAzureService
{
    private readonly Dictionary<string, decimal> _modelCosts = new()
    {
        ["gpt-4-32k"] = 0.06m,        // Most expensive but most capable
        ["gpt-4"] = 0.03m,            // High capability
        ["gpt-35-turbo"] = 0.002m     // Cost-effective
    };

    public async Task<string> GenerateWithCostOptimizationAsync(
        string prompt, 
        decimal maxCostUSD = 0.10m)
    {
        // Estimate token count
        var estimatedTokens = EstimateTokenCount(prompt) + 500; // Assume 500 response tokens
        
        // Select most cost-effective model that fits budget
        var selectedModel = SelectModelByBudget(estimatedTokens, maxCostUSD);
        
        if (selectedModel == null)
        {
            throw new BudgetExceededException($"No model available within budget of ${maxCostUSD}");
        }

        // Use the selected model
        var config = GetConfigForModel(selectedModel);
        var pipeline = TransformerPipelineFactory.CreateAzureOpenAIPipeline(
            runtimeManager, executeManager, config);

        await pipeline.LoadModelAsync(new TransformerModelInfo
        {
            Name = selectedModel,
            Source = TransformerModelSource.Azure
        }, TransformerTask.TextGeneration);

        var result = await pipeline.GenerateTextAsync(prompt);
        
        // Calculate actual cost
        var actualCost = CalculateActualCost(selectedModel, result.Usage.TotalTokens);
        Console.WriteLine($"Used model: {selectedModel}, Cost: ${actualCost:F4}");

        return result.Data;
    }

    private string? SelectModelByBudget(int estimatedTokens, decimal maxBudget)
    {
        foreach (var (model, costPerToken) in _modelCosts.OrderBy(x => x.Value))
        {
            var estimatedCost = estimatedTokens * costPerToken / 1000; // Cost per 1K tokens
            if (estimatedCost <= maxBudget)
            {
                return model;
            }
        }
        return null;
    }

    private decimal CalculateActualCost(string model, int tokens)
    {
        return tokens * _modelCosts[model] / 1000;
    }
}</code></pre>
                    </div>
                </section>

                <!-- Security Features -->
                <section class="section" id="security">
                    <h2>Security Features</h2>
                    
                    <div class="feature-grid">
                        <div class="feature-card">
                            <h4><i class="bi bi-shield-check"></i> Data Protection</h4>
                            <ul>
                                <li>Data encryption in transit and at rest</li>
                                <li>Regional data residency</li>
                                <li>No data used for model training</li>
                                <li>Configurable data retention</li>
                            </ul>
                        </div>
                        <div class="feature-card">
                            <h4><i class="bi bi-person-check"></i> Access Control</h4>
                            <ul>
                                <li>Azure AD integration</li>
                                <li>Role-based access control (RBAC)</li>
                                <li>API key management</li>
                                <li>Resource-level permissions</li>
                            </ul>
                        </div>
                        <div class="feature-card">
                            <h4><i class="bi bi-eye"></i> Monitoring</h4>
                            <ul>
                                <li>Azure Monitor integration</li>
                                <li>Real-time logging</li>
                                <li>Usage analytics</li>
                                <li>Security event tracking</li>
                            </ul>
                        </div>
                        <div class="feature-card">
                            <h4><i class="bi bi-check-circle"></i> Compliance</h4>
                            <ul>
                                <li>SOC 2 Type II certified</li>
                                <li>HIPAA compliance available</li>
                                <li>ISO 27001 certified</li>
                                <li>FedRAMP authorized</li>
                            </ul>
                        </div>
                    </div>

                    <div class="code-example">
                        <h4>Compliance Configuration</h4>
                        <pre><code class="language-csharp">var complianceConfig = new AzureOpenAIConnectionConfig
{
    Endpoint = "https://compliant-openai.openai.azure.com/",
    ApiKey = GetManagedIdentityKey(),
    
    ComplianceConfig = new ComplianceConfig
    {
        EnableHIPAACompliance = true,
        DataRetentionDays = 30,
        EnableAuditLogging = true,
        RequireDataClassification = true,
        
        ContentFilteringConfig = new ContentFilteringConfig
        {
            EnablePIIDetection = true,
            EnableProfanityFiltering = true,
            EnableThreatDetection = true,
            BlockRestrictedContent = true
        },
        
        EncryptionConfig = new EncryptionConfig
        {
            EncryptDataInTransit = true,
            EncryptDataAtRest = true,
            UseCustomerManagedKeys = true,
            KeyVaultUrl = "https://company-keyvault.vault.azure.net/"
        }
    }
};</code></pre>
                    </div>
                </section>

                <!-- Performance & Scaling -->
                <section class="section" id="performance">
                    <h2>Performance & Scaling</h2>
                    
                    <div class="code-example">
                        <h4>Auto-Scaling Configuration</h4>
                        <pre><code class="language-csharp">public class AzureAutoScalingService
{
    public async Task ConfigureAutoScalingAsync()
    {
        var scalingConfig = new AzureScalingConfig
        {
            MinInstances = 2,
            MaxInstances = 20,
            TargetUtilization = 70,
            ScaleUpCooldownMinutes = 5,
            ScaleDownCooldownMinutes = 15,
            
            ScalingRules = new[]
            {
                new ScalingRule
                {
                    MetricName = "RequestsPerSecond",
                    Threshold = 50,
                    Action = ScalingAction.ScaleUp,
                    InstanceCount = 2
                },
                new ScalingRule
                {
                    MetricName = "AverageResponseTime",
                    Threshold = 5000, // 5 seconds
                    Action = ScalingAction.ScaleUp,
                    InstanceCount = 1
                },
                new ScalingRule
                {
                    MetricName = "RequestsPerSecond",
                    Threshold = 10,
                    Action = ScalingAction.ScaleDown,
                    InstanceCount = 1
                }
            }
        };

        await _azureResourceManager.ConfigureAutoScalingAsync(
            resourceGroupName: "openai-rg",
            resourceName: "openai-service",
            scalingConfig: scalingConfig);
    }

    public async Task<PerformanceMetrics> GetPerformanceMetricsAsync()
    {
        return await _azureMonitor.GetMetricsAsync(new MetricsQuery
        {
            ResourceId = "/subscriptions/{sub}/resourceGroups/{rg}/providers/Microsoft.CognitiveServices/accounts/{account}",
            MetricNames = new[] 
            { 
                "TotalCalls", 
                "SuccessfulCalls", 
                "TotalErrors", 
                "ProcessedPromptTokens",
                "GeneratedCompletionTokens"
            },
            TimeRange = TimeSpan.FromHours(1)
        });
    }
}</code></pre>
                    </div>
                </section>

                <!-- Related Classes -->
                <section class="section" id="related">
                    <h2>?? Related Classes</h2>
                    <ul class="member-list">
                        <li>
                            <div class="member-name">OpenAITransformerPipeline</div>
                            <div class="member-type">Pipeline Class</div>
                            <div class="member-desc">Direct OpenAI service integration</div>
                        </li>
                        <li>
                            <div class="member-name">AzureOpenAIConnectionConfig</div>
                            <div class="member-type">Configuration Class</div>
                            <div class="member-desc">Azure-specific configuration options</div>
                        </li>
                        <li>
                            <div class="member-name">BaseTransformerPipeline</div>
                            <div class="member-type">Abstract Class</div>
                            <div class="member-desc">Common pipeline functionality</div>
                        </li>
                    </ul>
                </section>

                <!-- Navigation Links -->
                <div class="nav-links">
                    <a href="OpenAITransformerPipeline.html" class="btn-beep">
                        <i class="bi bi-arrow-left"></i> OpenAI Pipeline
                    </a>
                    <a href="GoogleTransformerPipeline.html" class="btn-beep">
                        <i class="bi bi-arrow-right"></i> Google AI Pipeline
                    </a>
                </div>

                <!-- Footer -->
                <footer class="documentation-footer">
                    <div class="footer-content">
                        <div class="footer-copyright">
                            <p>&copy; 2024 The Tech Idea - Beep.Python.AI.Transformers API Documentation</p>
                        </div>
                        <div class="footer-links">
                            <a href="../index.html">Home</a>
                            <a href="ITransformerPipeLine.html">ITransformerPipeLine</a>
                            <a href="TransformerPipelineFactory.html">Pipeline Factory</a>
                        </div>
                    </div>
                </footer>
            </div>
        </main>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script src="../assets/navigation.js"></script>
</body>
</html>